From 8357c883c367298d96bfe4a12535bd909ca9e9eb Mon Sep 17 00:00:00 2001
From: Kaan Alsan <alsan@chromium.org>
Date: Mon, 19 Jan 2026 13:35:44 -0800
Subject: [PATCH] Provide vertical tab view collection nodes directly to drag handler

This is a refactor that renames
VerticalTabDragHandler::DraggedTabsOverNode to
HandleDraggedTabsOverNode, and updates VerticalUnpinnedTabContainerView
and VerticalTabGroupView to provide the collection node of their child
views directly to the drag handler rather than using an `OnTabDragOver`
method on the individual views.

Change-Id: I51f886fe032026174e5f1c244afc7045008b721f
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/7495215
Reviewed-by: Eshwar Stalin <estalin@chromium.org>
Commit-Queue: Kaan Alsan <alsan@chromium.org>
Cr-Commit-Position: refs/heads/main@{#1571346}
---

--- a/chrome/browser/ui/views/tabs/vertical/vertical_split_tab_view.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_split_tab_view.cc
@@ -188,11 +188,5 @@ void VerticalSplitTabView::UpdateBorder(
   }
 }
 
-void VerticalSplitTabView::OnTabDragOver() {
-  auto* controller = collection_node_->GetController();
-  CHECK(controller);
-  controller->GetDragHandler().DraggedTabsOverNode(*collection_node_);
-}
-
 BEGIN_METADATA(VerticalSplitTabView)
 END_METADATA
--- a/chrome/browser/ui/views/tabs/vertical/vertical_split_tab_view.h
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_split_tab_view.h
@@ -42,7 +42,7 @@ class VerticalSplitTabView : public view
     return hover_controller_.get();
   }
 
-  void OnTabDragOver();
+  const TabCollectionNode* collection_node() const { return collection_node_; }
 
  private:
   void ResetCollectionNode();
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_drag_handler.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_drag_handler.cc
@@ -126,7 +126,7 @@ void VerticalTabDragHandlerImpl::EndDrag
   ResetDragState();
 }
 
-void VerticalTabDragHandlerImpl::DraggedTabsOverNode(
+void VerticalTabDragHandlerImpl::HandleDraggedTabsOverNode(
     const TabCollectionNode& node) {
   if (!drag_controller_) {
     // Do nothing if the drag is not attached to our context yet (e.g. on the
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_drag_handler.h
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_drag_handler.h
@@ -35,7 +35,7 @@ class VerticalTabDragHandler {
   virtual void EndDrag(EndDragReason reason) = 0;
 
   // Handles tab strip model updates to reflect a drag over a give tab node.
-  virtual void DraggedTabsOverNode(const TabCollectionNode& node) = 0;
+  virtual void HandleDraggedTabsOverNode(const TabCollectionNode& node) = 0;
 
   // Returns the drag context for this handler.
   virtual TabDragContext* GetDragContext() = 0;
@@ -73,7 +73,7 @@ class VerticalTabDragHandlerImpl : publi
   bool ContinueDrag(views::View& event_source_view,
                     const ui::MouseEvent& event) override;
   void EndDrag(EndDragReason reason) override;
-  void DraggedTabsOverNode(const TabCollectionNode& node) override;
+  void HandleDraggedTabsOverNode(const TabCollectionNode& node) override;
   TabDragContext* GetDragContext() override;
   bool IsViewDragging(const views::View& view) const override;
 
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_group_view.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_group_view.cc
@@ -248,20 +248,15 @@ void VerticalTabGroupView::HandleTabDrag
     const gfx::Point point_in_container) {
   views::View* view_at_point =
       GetViewAtPoint(layout_manager_->target_layout(), point_in_container);
+  const TabCollectionNode* node = collection_node_;
   if (auto* tab_view = views::AsViewClass<VerticalTabView>(view_at_point)) {
-    tab_view->OnTabDragOver();
+    node = tab_view->collection_node();
   } else if (auto* split_tab_view =
                  views::AsViewClass<VerticalSplitTabView>(view_at_point)) {
-    split_tab_view->OnTabDragOver();
-  } else {
-    // If the drag isn't over any tab views including the header, then treat it
-    // as a drag over the group view container.
-    GetDragHandler().DraggedTabsOverNode(*collection_node_);
+    node = split_tab_view->collection_node();
   }
-}
-
-void VerticalTabGroupView::OnTabDragOver() {
-  GetDragHandler().DraggedTabsOverNode(*collection_node_);
+  CHECK(node);
+  GetDragHandler().HandleDraggedTabsOverNode(*node);
 }
 
 BEGIN_METADATA(VerticalTabGroupView)
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_group_view.h
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_group_view.h
@@ -52,8 +52,7 @@ class VerticalTabGroupView
 
   bool IsCollapsed() const;
 
-  // Handler when a tab that is not in the group is dragged over this.
-  void OnTabDragOver();
+  const TabCollectionNode* collection_node() const { return collection_node_; }
 
   VerticalTabGroupHeaderView* group_header_for_testing() {
     return group_header_;
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_view.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_view.cc
@@ -207,12 +207,6 @@ void VerticalTabView::UpdateHovered(bool
   UpdateCloseButtonVisibility();
 }
 
-void VerticalTabView::OnTabDragOver() {
-  auto* controller = collection_node_->GetController();
-  CHECK(controller);
-  controller->GetDragHandler().DraggedTabsOverNode(*collection_node_);
-}
-
 bool VerticalTabView::OnKeyPressed(const ui::KeyEvent& event) {
   if (event.key_code() == ui::VKEY_RETURN && selected_) {
     collection_node_->GetController()->SelectTab(GetTabInterface(),
--- a/chrome/browser/ui/views/tabs/vertical/vertical_tab_view.h
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_tab_view.h
@@ -55,7 +55,7 @@ class VerticalTabView : public views::Vi
   void StepLoadingAnimation(const base::TimeDelta& elapsed_time);
   void UpdateHovered(bool hovered);
 
-  void OnTabDragOver();
+  const TabCollectionNode* collection_node() const { return collection_node_; }
   const TabStyle* tab_style() { return tab_style_; }
   const TabRendererData& tab_data() const { return tab_data_; }
   TabCloseButton* close_button_for_testing() { return close_button_; }
--- a/chrome/browser/ui/views/tabs/vertical/vertical_unpinned_tab_container_view.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_unpinned_tab_container_view.cc
@@ -135,19 +135,18 @@ void VerticalUnpinnedTabContainerView::H
   const views::ProposedLayout& target_layout = layout_manager_->target_layout();
   views::View* view_at_point =
       GetViewAtPoint(target_layout, point_in_container);
+  const TabCollectionNode* node = collection_node_;
   if (auto* tab_view = views::AsViewClass<VerticalTabView>(view_at_point)) {
-    tab_view->OnTabDragOver();
+    node = tab_view->collection_node();
   } else if (auto* group_view =
                  views::AsViewClass<VerticalTabGroupView>(view_at_point)) {
-    group_view->OnTabDragOver();
+    node = group_view->collection_node();
   } else if (auto* split_tab_view =
                  views::AsViewClass<VerticalSplitTabView>(view_at_point)) {
-    split_tab_view->OnTabDragOver();
-  } else {
-    // If the drag isn't over any child views, then treat it as a drag over
-    // the unpinned tab container.
-    GetDragHandler().DraggedTabsOverNode(*collection_node_);
+    node = split_tab_view->collection_node();
   }
+  CHECK(node);
+  GetDragHandler().HandleDraggedTabsOverNode(*node);
 }
 
 BEGIN_METADATA(VerticalUnpinnedTabContainerView)
