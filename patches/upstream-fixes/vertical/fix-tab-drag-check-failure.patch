From a790ee16984c39839af6f7371d5e020d674315ee Mon Sep 17 00:00:00 2001
From: Eshwar Stalin <estalin@chromium.org>
Date: Mon, 02 Feb 2026 13:55:59 -0800
Subject: [PATCH] [Vertical Tabs] Fix a CHECK failure during tab dragging

Currently there are times InitializeDragState is run multiple times when
dragging between unpinned and groups which causes a CHECK failure with
dragging_views_bounds_ not being empty.

This is because unpinned container when handling dragging in container
sometime triggers model updates for the group. This results in the drag
tabs to remain parented to the groups instead of being parented to
unpinned container. The root issue here is groups themselves are a drag
target except when collapsed or if we are in header drag. These are the
only cases where we should trigger model updates using the group
collection node. Otherwise, we need to trigger model updates using the
unpinned collection node to ensure correct parenting of dragging views.

Additionally, better handling header dragging over other groups using
the group header as cross over point to prevent bouncing issue.

Fixed: 481021603
Change-Id: Id61cf3754117d29dac8507a0d2e36ab52e902440
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/7537139
Reviewed-by: Kaan Alsan <alsan@chromium.org>
Commit-Queue: Eshwar Stalin <estalin@chromium.org>
Cr-Commit-Position: refs/heads/main@{#1578378}
---

--- a/chrome/browser/ui/views/tabs/vertical/vertical_dragged_tabs_container.cc
+++ b/chrome/browser/ui/views/tabs/vertical/vertical_dragged_tabs_container.cc
@@ -125,8 +125,10 @@ void VerticalDraggedTabsContainer::OnVie
   // The transformation coordinates are relative to the host view's coordinates,
   // so they must be updated as the bounds change to ensure the dragged tabs
   // remain at the same point in the screen.
-  UpdateDraggingViewTransforms(views::View::ConvertPointFromScreen(
-      base::to_address(host_view_), last_drag_point_in_screen_));
+  if (!dragging_views_.empty()) {
+    UpdateDraggingViewTransforms(views::View::ConvertPointFromScreen(
+        base::to_address(host_view_), last_drag_point_in_screen_));
+  }
 }
 
 void VerticalDraggedTabsContainer::InitializeDragState(
