From 616581ba45c8d72645a29019702353f57dd0870d Mon Sep 17 00:00:00 2001
From: Thomas Lukaszewicz <tluk@chromium.org>
Date: Mon, 02 Feb 2026 16:41:26 -0800
Subject: [PATCH] [Vertical Tabs] Eliminate TabStripRegionView::StopAnimating()

API is no longer necessary. Existing clients are transitioned to
use ScopedAnimationDurationScaleMode instead.

Bug: 459824840
Change-Id: Idf5ac52b3a9128515af0e72c80885b270d28d55c
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/7534358
Reviewed-by: David Pennington <dpenning@chromium.org>
Commit-Queue: Tom Lukaszewicz <tluk@chromium.org>
Cr-Commit-Position: refs/heads/main@{#1578463}
---

--- a/chrome/browser/ui/ash/shell_delegate/tab_scrubber_browsertest.cc
+++ b/chrome/browser/ui/ash/shell_delegate/tab_scrubber_browsertest.cc
@@ -32,6 +32,7 @@
 #include "ui/aura/window.h"
 #include "ui/events/event_utils.h"
 #include "ui/events/test/event_generator.h"
+#include "ui/gfx/animation/animation_test_api.h"
 #include "ui/wm/core/window_util.h"
 
 namespace {
@@ -261,8 +262,6 @@ class TabScrubberTest : public InProcess
     ASSERT_EQ(num_tabs, browser->tab_strip_model()->active_index());
     BrowserView* browser_view = BrowserView::GetBrowserViewForBrowser(browser);
     CHECK(browser_view);
-    browser_view->tab_strip_view()->StopAnimating();
-    ASSERT_FALSE(browser_view->tab_strip_view()->IsAnimating());
     // Perform any scheduled layouts so the tabstrip is in a steady state.
     browser_view->GetWidget()->LayoutRootViewIfNecessary();
   }
@@ -338,6 +337,10 @@ class TabScrubberTest : public InProcess
   };
 
   std::unique_ptr<exo::WMHelper> wm_helper_;
+
+  const gfx::AnimationTestApi::RenderModeResetter disable_rich_animations_ =
+      gfx::AnimationTestApi::SetRichAnimationRenderMode(
+          gfx::Animation::RichAnimationRenderMode::FORCE_DISABLED);
 };
 
 // Swipe a single tab in each direction.
--- a/chrome/browser/ui/views/bookmarks/saved_tab_groups/saved_tab_group_interactive_uitest.cc
+++ b/chrome/browser/ui/views/bookmarks/saved_tab_groups/saved_tab_group_interactive_uitest.cc
@@ -79,6 +79,7 @@
 #include "ui/events/keycodes/keyboard_codes.h"
 #include "ui/events/test/event_generator.h"
 #include "ui/events/types/event_type.h"
+#include "ui/gfx/animation/animation_test_api.h"
 #include "ui/gfx/skia_util.h"
 #include "ui/views/controls/menu/menu_item_view.h"
 #include "ui/views/interaction/element_tracker_views.h"
@@ -1078,6 +1079,10 @@ IN_PROC_BROWSER_TEST_P(SavedTabGroupInte
 // interpreted as an absolute position.
 IN_PROC_BROWSER_TEST_P(SavedTabGroupInteractiveTest,
                        DISABLED_DragGroupWithinBar) {
+  const gfx::AnimationTestApi::RenderModeResetter disable_rich_animations =
+      gfx::AnimationTestApi::SetRichAnimationRenderMode(
+          gfx::Animation::RichAnimationRenderMode::FORCE_DISABLED);
+
   // Create two tab groups with one tab each.
   const tab_groups::TabGroupId group_id_1 =
       browser()->tab_strip_model()->AddToNewGroup({0});
@@ -1085,9 +1090,6 @@ IN_PROC_BROWSER_TEST_P(SavedTabGroupInte
                                                     AddTabTypes::ADD_NONE);
   const tab_groups::TabGroupId group_id_2 =
       browser()->tab_strip_model()->AddToNewGroup({1});
-  BrowserView::GetBrowserViewForBrowser(browser())
-      ->tab_strip_view()
-      ->StopAnimating();
 
   const char kSavedTabGroupButton1[] = "SavedTabGroupButton1";
   const char kSavedTabGroupButton2[] = "SavedTabGroupButton2";
--- a/chrome/browser/ui/views/frame/horizontal_tab_strip_region_view.cc
+++ b/chrome/browser/ui/views/frame/horizontal_tab_strip_region_view.cc
@@ -559,14 +559,6 @@ bool HorizontalTabStripRegionView::IsTab
   return tab_strip_->IsTabStripCloseable();
 }
 
-bool HorizontalTabStripRegionView::IsAnimating() const {
-  return tab_strip_->IsAnimatingInTabStrip();
-}
-
-void HorizontalTabStripRegionView::StopAnimating() {
-  return tab_strip_->StopAnimating();
-}
-
 void HorizontalTabStripRegionView::UpdateLoadingAnimations(
     const base::TimeDelta& elapsed_time) {
   tab_strip_->UpdateLoadingAnimations(elapsed_time);
--- a/chrome/browser/ui/views/frame/horizontal_tab_strip_region_view.h
+++ b/chrome/browser/ui/views/frame/horizontal_tab_strip_region_view.h
@@ -105,8 +105,6 @@ class HorizontalTabStripRegionView final
   bool IsTabStripEditable() const override;
   void DisableTabStripEditingForTesting() const override;
   bool IsTabStripCloseable() const override;
-  bool IsAnimating() const override;
-  void StopAnimating() override;
   void UpdateLoadingAnimations(const base::TimeDelta& elapsed_time) override;
   std::optional<int> GetFocusedTabIndex() const override;
   const TabRendererData& GetTabRendererData(int tab_index) override;
--- a/chrome/browser/ui/views/frame/tab_strip_region_view.h
+++ b/chrome/browser/ui/views/frame/tab_strip_region_view.h
@@ -34,8 +34,6 @@ class TabStripRegionView : public views:
   virtual bool IsTabStripEditable() const = 0;
   virtual void DisableTabStripEditingForTesting() const = 0;
   virtual bool IsTabStripCloseable() const = 0;
-  virtual bool IsAnimating() const = 0;
-  virtual void StopAnimating() = 0;
   virtual void UpdateLoadingAnimations(const base::TimeDelta& elapsed_time) = 0;
   virtual std::optional<int> GetFocusedTabIndex() const = 0;
   virtual const TabRendererData& GetTabRendererData(int tab_index) = 0;
--- a/chrome/browser/ui/views/frame/vertical_tab_strip_region_view.cc
+++ b/chrome/browser/ui/views/frame/vertical_tab_strip_region_view.cc
@@ -222,14 +222,6 @@ bool VerticalTabStripRegionView::IsTabSt
   return !drag_controller || drag_controller->IsMovingLastTab();
 }
 
-bool VerticalTabStripRegionView::IsAnimating() const {
-  return false;
-}
-
-void VerticalTabStripRegionView::StopAnimating() {
-  // Do nothing.
-}
-
 void VerticalTabStripRegionView::UpdateLoadingAnimations(
     const base::TimeDelta& elapsed_time) {
   for (tabs::TabInterface* tab : *tab_strip_model_) {
--- a/chrome/browser/ui/views/frame/vertical_tab_strip_region_view.h
+++ b/chrome/browser/ui/views/frame/vertical_tab_strip_region_view.h
@@ -105,8 +105,6 @@ class VerticalTabStripRegionView final :
   bool IsTabStripEditable() const override;
   void DisableTabStripEditingForTesting() const override;
   bool IsTabStripCloseable() const override;
-  bool IsAnimating() const override;
-  void StopAnimating() override;
   void UpdateLoadingAnimations(const base::TimeDelta& elapsed_time) override;
   std::optional<int> GetFocusedTabIndex() const override;
   const TabRendererData& GetTabRendererData(int tab_index) override;
--- a/chrome/browser/ui/views/performance_controls/memory_saver_interactive_ui_test.cc
+++ b/chrome/browser/ui/views/performance_controls/memory_saver_interactive_ui_test.cc
@@ -70,6 +70,7 @@
 #include "ui/base/l10n/l10n_util.h"
 #include "ui/base/text/bytes_formatting.h"
 #include "ui/gfx/animation/animation.h"
+#include "ui/gfx/animation/animation_test_api.h"
 #include "ui/views/controls/button/button.h"
 #include "ui/views/controls/button/label_button.h"
 #include "ui/views/controls/styled_label.h"
@@ -810,6 +811,10 @@ class MemorySaverImprovedFaviconTreatmen
   }
 
  private:
+  const gfx::AnimationTestApi::RenderModeResetter disable_rich_animations_ =
+      gfx::AnimationTestApi::SetRichAnimationRenderMode(
+          gfx::Animation::RichAnimationRenderMode::FORCE_DISABLED);
+
   base::test::ScopedFeatureList scoped_feature_list_;
 };
 
@@ -823,8 +828,6 @@ IN_PROC_BROWSER_TEST_P(MemorySaverImprov
       InstrumentTab(kFirstTabContents, 0),
       NavigateWebContents(kFirstTabContents, GetURL()),
       AddInstrumentedTab(kSecondTabContents, GURL(kOtherPage)),
-      Do(base::BindLambdaForTesting(
-          [=, this]() { GetTabStripView()->StopAnimating(); })),
       TryDiscardTab(0), CheckTabIsDiscarded(0, true),
       NameView(kFirstTabFavicon, base::BindLambdaForTesting([&]() {
                  return views::AsViewClass<views::View>(GetTabIcon(0));
@@ -855,8 +858,6 @@ IN_PROC_BROWSER_TEST_P(MemorySaverImprov
       AddInstrumentedTab(
           kPerformanceSettingsTab,
           GURL(chrome::GetSettingsUrl(chrome::kPerformanceSubPage))),
-      Do(base::BindLambdaForTesting(
-          [=, this]() { GetTabStripView()->StopAnimating(); })),
       TryDiscardTab(0), CheckTabIsDiscarded(0, true),
       NameView(kFirstTabFavicon, base::BindLambdaForTesting([&]() {
                  return views::AsViewClass<views::View>(GetTabIcon(0));
--- a/chrome/browser/ui/views/tabs/dragging/dragging_tabs_session_browsertest.cc
+++ b/chrome/browser/ui/views/tabs/dragging/dragging_tabs_session_browsertest.cc
@@ -15,6 +15,7 @@
 #include "components/tabs/public/tab_interface.h"
 #include "content/public/test/browser_test.h"
 #include "ui/base/models/list_selection_model.h"
+#include "ui/gfx/animation/animation_test_api.h"
 #include "ui/gfx/geometry/point.h"
 #include "ui/gfx/geometry/vector2d.h"
 #include "ui/views/view.h"
@@ -40,7 +41,6 @@ class DraggingTabsSessionBrowserTest : p
   std::tuple<tabs::TabInterface*, views::View*> AddTab(int index,
                                                        bool foreground) {
     chrome::AddTabAt(browser(), GURL("about:blank"), index, foreground);
-    view_->StopAnimating();
     return std::make_tuple(model_->GetTabAtIndex(index),
                            view_->GetTabAnchorViewAt(index));
   }
@@ -76,6 +76,10 @@ class DraggingTabsSessionBrowserTest : p
 
   raw_ptr<TabStripModel> model_;
   raw_ptr<TabStripRegionView> view_;
+
+  const gfx::AnimationTestApi::RenderModeResetter disable_rich_animations_ =
+      gfx::AnimationTestApi::SetRichAnimationRenderMode(
+          gfx::Animation::RichAnimationRenderMode::FORCE_DISABLED);
 };
 
 // Flaky. http://crbug.com/417465013
